from flask import Flask, jsonify,render_template
from route_plan import *
app = Flask(__name__)
@app.route('/')
def index():
    return render_template('show_demo.html')

# 假设这是你规划路线的函数 (简化为“...”)


@app.route('/api/best_routes', methods=['GET'])
def get_best_routes():
    """
    返回若干条最优路线的 JSON 数据。
    """
    # 这里写你实际的调用逻辑，比如:
    # best_routes = plan_routes(csv_file_path, start_lng, start_lat, end_lng, end_lat, k=3)
    # 简化演示:
    # best_routes = plan_routes()  # 用上面伪造的plan_routes
    start_longitude, start_latitude = 9.795039, 56.145715  # 北京天安门
    end_longitude, end_latitude = 10.116847, 56.224939  # 北京某地示例
    # 获取前三条最快路线
    # best_3_routes = [{'route_rank': 1, 'path': [{'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 8360.762990708154, 'POINT_1_LNG': 9.795039, 'POINT_1_LAT': 56.145715, 'POINT_2_LNG': 10.064734635581999, 'POINT_2_LAT': 56.152447520476194}, {'REPORT_ID': '195233', 'DURATION_IN_SEC': 120.0, 'POINT_1_LNG': 10.064734635581999, 'POINT_1_LAT': 56.152447520476194, 'POINT_2_LNG': 10.087895233135214, 'POINT_2_LAT': 56.15286327729632}, {'REPORT_ID': '195286', 'DURATION_IN_SEC': 92.0, 'POINT_1_LNG': 10.087895233135214, 'POINT_1_LAT': 56.15286327729632, 'POINT_2_LNG': 10.110953550926183, 'POINT_2_LAT': 56.15328110479527}, {'REPORT_ID': '182901', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.123139046627102, 'POINT_1_LAT': 56.15256095040008, 'POINT_2_LNG': 10.110953550926183, 'POINT_2_LAT': 56.15328110479527}, {'REPORT_ID': '182955', 'DURATION_IN_SEC': 38.0, 'POINT_1_LNG': 10.131331836805202, 'POINT_1_LAT': 56.152757286457955, 'POINT_2_LNG': 10.123139046627102, 'POINT_2_LAT': 56.15256095040008}, {'REPORT_ID': '182983', 'DURATION_IN_SEC': 33.0, 'POINT_1_LNG': 10.131331836805202, 'POINT_1_LAT': 56.152757286457955, 'POINT_2_LNG': 10.139060373016491, 'POINT_2_LAT': 56.153135887760996}, {'REPORT_ID': '187032', 'DURATION_IN_SEC': 90.0, 'POINT_1_LNG': 10.139060373016491, 'POINT_1_LAT': 56.153135887760996, 'POINT_2_LNG': 10.143520804893456, 'POINT_2_LAT': 56.16018043015113}, {'REPORT_ID': '180573', 'DURATION_IN_SEC': 67.0, 'POINT_1_LNG': 10.143520804893456, 'POINT_1_LAT': 56.16018043015113, 'POINT_2_LNG': 10.1515794551907, 'POINT_2_LAT': 56.167867187555736}, {'REPORT_ID': '179444', 'DURATION_IN_SEC': 67.0, 'POINT_1_LNG': 10.1515794551907, 'POINT_1_LAT': 56.167867187555736, 'POINT_2_LNG': 10.161823402446771, 'POINT_2_LAT': 56.17304495205962}, {'REPORT_ID': '179390', 'DURATION_IN_SEC': 41.0, 'POINT_1_LNG': 10.161823402446771, 'POINT_1_LAT': 56.17304495205962, 'POINT_2_LNG': 10.171611868717264, 'POINT_2_LAT': 56.174917180024806}, {'REPORT_ID': '179336', 'DURATION_IN_SEC': 65.0, 'POINT_1_LNG': 10.171611868717264, 'POINT_1_LAT': 56.174917180024806, 'POINT_2_LNG': 10.18461071717934, 'POINT_2_LAT': 56.178623267668705}, {'REPORT_ID': '179282', 'DURATION_IN_SEC': 34.0, 'POINT_1_LNG': 10.18461071717934, 'POINT_1_LAT': 56.178623267668705, 'POINT_2_LNG': 10.192906008598356, 'POINT_2_LAT': 56.181353258286634}, {'REPORT_ID': '185078', 'DURATION_IN_SEC': 61.0, 'POINT_1_LNG': 10.192906008598356, 'POINT_1_LAT': 56.181353258286634, 'POINT_2_LNG': 10.19604842460626, 'POINT_2_LAT': 56.184659561973874}, {'REPORT_ID': '192653', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.19604842460626, 'POINT_1_LAT': 56.184659561973874, 'POINT_2_LNG': 10.191119927578029, 'POINT_2_LAT': 56.18958131478287}, {'REPORT_ID': '192600', 'DURATION_IN_SEC': 80.0, 'POINT_1_LNG': 10.191119927578029, 'POINT_1_LAT': 56.18958131478287, 'POINT_2_LNG': 10.182444749668093, 'POINT_2_LAT': 56.19922307868954}, {'REPORT_ID': '159043', 'DURATION_IN_SEC': 37.0, 'POINT_1_LNG': 10.182444749668093, 'POINT_1_LAT': 56.19922307868954, 'POINT_2_LNG': 10.175406949737521, 'POINT_2_LAT': 56.20417258212644}, {'REPORT_ID': '158954', 'DURATION_IN_SEC': 46.0, 'POINT_1_LNG': 10.175406949737521, 'POINT_1_LAT': 56.20417258212644, 'POINT_2_LNG': 10.161186577298167, 'POINT_2_LAT': 56.20869704245814}, {'REPORT_ID': '158924', 'DURATION_IN_SEC': 79.0, 'POINT_1_LNG': 10.161186577298167, 'POINT_1_LAT': 56.20869704245814, 'POINT_2_LNG': 10.13978019262504, 'POINT_2_LAT': 56.21508593264829}, {'REPORT_ID': '158505', 'DURATION_IN_SEC': 106.0, 'POINT_1_LNG': 10.13978019262504, 'POINT_1_LAT': 56.21508593264829, 'POINT_2_LNG': 10.116589665412903, 'POINT_2_LAT': 56.22579478256016}, {'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 48.23956400149524, 'POINT_1_LNG': 10.116589665412903, 'POINT_1_LAT': 56.22579478256016, 'POINT_2_LNG': 10.116847, 'POINT_2_LAT': 56.224939}], 'total_duration': 9575.002554709648}, {'route_rank': 2, 'path': [{'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 8360.762990708154, 'POINT_1_LNG': 9.795039, 'POINT_1_LAT': 56.145715, 'POINT_2_LNG': 10.064734635581999, 'POINT_2_LAT': 56.152447520476194}, {'REPORT_ID': '195259', 'DURATION_IN_SEC': 125.0, 'POINT_1_LNG': 10.087875116567602, 'POINT_1_LAT': 56.1529230346212, 'POINT_2_LNG': 10.064734635581999, 'POINT_2_LAT': 56.152447520476194}, {'REPORT_ID': '195312', 'DURATION_IN_SEC': 94.0, 'POINT_1_LNG': 10.110953550926183, 'POINT_1_LAT': 56.15328110479527, 'POINT_2_LNG': 10.087875116567602, 'POINT_2_LAT': 56.1529230346212}, {'REPORT_ID': '182901', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.123139046627102, 'POINT_1_LAT': 56.15256095040008, 'POINT_2_LNG': 10.110953550926183, 'POINT_2_LAT': 56.15328110479527}, {'REPORT_ID': '182955', 'DURATION_IN_SEC': 38.0, 'POINT_1_LNG': 10.131331836805202, 'POINT_1_LAT': 56.152757286457955, 'POINT_2_LNG': 10.123139046627102, 'POINT_2_LAT': 56.15256095040008}, {'REPORT_ID': '182983', 'DURATION_IN_SEC': 33.0, 'POINT_1_LNG': 10.131331836805202, 'POINT_1_LAT': 56.152757286457955, 'POINT_2_LNG': 10.139060373016491, 'POINT_2_LAT': 56.153135887760996}, {'REPORT_ID': '187032', 'DURATION_IN_SEC': 90.0, 'POINT_1_LNG': 10.139060373016491, 'POINT_1_LAT': 56.153135887760996, 'POINT_2_LNG': 10.143520804893456, 'POINT_2_LAT': 56.16018043015113}, {'REPORT_ID': '180573', 'DURATION_IN_SEC': 67.0, 'POINT_1_LNG': 10.143520804893456, 'POINT_1_LAT': 56.16018043015113, 'POINT_2_LNG': 10.1515794551907, 'POINT_2_LAT': 56.167867187555736}, {'REPORT_ID': '179444', 'DURATION_IN_SEC': 67.0, 'POINT_1_LNG': 10.1515794551907, 'POINT_1_LAT': 56.167867187555736, 'POINT_2_LNG': 10.161823402446771, 'POINT_2_LAT': 56.17304495205962}, {'REPORT_ID': '179390', 'DURATION_IN_SEC': 41.0, 'POINT_1_LNG': 10.161823402446771, 'POINT_1_LAT': 56.17304495205962, 'POINT_2_LNG': 10.171611868717264, 'POINT_2_LAT': 56.174917180024806}, {'REPORT_ID': '179336', 'DURATION_IN_SEC': 65.0, 'POINT_1_LNG': 10.171611868717264, 'POINT_1_LAT': 56.174917180024806, 'POINT_2_LNG': 10.18461071717934, 'POINT_2_LAT': 56.178623267668705}, {'REPORT_ID': '179282', 'DURATION_IN_SEC': 34.0, 'POINT_1_LNG': 10.18461071717934, 'POINT_1_LAT': 56.178623267668705, 'POINT_2_LNG': 10.192906008598356, 'POINT_2_LAT': 56.181353258286634}, {'REPORT_ID': '185078', 'DURATION_IN_SEC': 61.0, 'POINT_1_LNG': 10.192906008598356, 'POINT_1_LAT': 56.181353258286634, 'POINT_2_LNG': 10.19604842460626, 'POINT_2_LAT': 56.184659561973874}, {'REPORT_ID': '192653', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.19604842460626, 'POINT_1_LAT': 56.184659561973874, 'POINT_2_LNG': 10.191119927578029, 'POINT_2_LAT': 56.18958131478287}, {'REPORT_ID': '192600', 'DURATION_IN_SEC': 80.0, 'POINT_1_LNG': 10.191119927578029, 'POINT_1_LAT': 56.18958131478287, 'POINT_2_LNG': 10.182444749668093, 'POINT_2_LAT': 56.19922307868954}, {'REPORT_ID': '159043', 'DURATION_IN_SEC': 37.0, 'POINT_1_LNG': 10.182444749668093, 'POINT_1_LAT': 56.19922307868954, 'POINT_2_LNG': 10.175406949737521, 'POINT_2_LAT': 56.20417258212644}, {'REPORT_ID': '158954', 'DURATION_IN_SEC': 46.0, 'POINT_1_LNG': 10.175406949737521, 'POINT_1_LAT': 56.20417258212644, 'POINT_2_LNG': 10.161186577298167, 'POINT_2_LAT': 56.20869704245814}, {'REPORT_ID': '158924', 'DURATION_IN_SEC': 79.0, 'POINT_1_LNG': 10.161186577298167, 'POINT_1_LAT': 56.20869704245814, 'POINT_2_LNG': 10.13978019262504, 'POINT_2_LAT': 56.21508593264829}, {'REPORT_ID': '158505', 'DURATION_IN_SEC': 106.0, 'POINT_1_LNG': 10.13978019262504, 'POINT_1_LAT': 56.21508593264829, 'POINT_2_LNG': 10.116589665412903, 'POINT_2_LAT': 56.22579478256016}, {'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 48.23956400149524, 'POINT_1_LNG': 10.116589665412903, 'POINT_1_LAT': 56.22579478256016, 'POINT_2_LNG': 10.116847, 'POINT_2_LAT': 56.224939}], 'total_duration': 9582.002554709648}, {'route_rank': 3, 'path': [{'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 8360.762990708154, 'POINT_1_LNG': 9.795039, 'POINT_1_LAT': 56.145715, 'POINT_2_LNG': 10.064734635581999, 'POINT_2_LAT': 56.152447520476194}, {'REPORT_ID': '195233', 'DURATION_IN_SEC': 120.0, 'POINT_1_LNG': 10.064734635581999, 'POINT_1_LAT': 56.152447520476194, 'POINT_2_LNG': 10.087895233135214, 'POINT_2_LAT': 56.15286327729632}, {'REPORT_ID': '195286', 'DURATION_IN_SEC': 92.0, 'POINT_1_LNG': 10.087895233135214, 'POINT_1_LAT': 56.15286327729632, 'POINT_2_LNG': 10.110953550926183, 'POINT_2_LAT': 56.15328110479527}, {'REPORT_ID': '182901', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.123139046627102, 'POINT_1_LAT': 56.15256095040008, 'POINT_2_LNG': 10.110953550926183, 'POINT_2_LAT': 56.15328110479527}, {'REPORT_ID': '182955', 'DURATION_IN_SEC': 38.0, 'POINT_1_LNG': 10.131331836805202, 'POINT_1_LAT': 56.152757286457955, 'POINT_2_LNG': 10.123139046627102, 'POINT_2_LAT': 56.15256095040008}, {'REPORT_ID': '183009', 'DURATION_IN_SEC': 35.0, 'POINT_1_LNG': 10.139025504299298, 'POINT_1_LAT': 56.153267352820414, 'POINT_2_LNG': 10.131331836805202, 'POINT_2_LAT': 56.152757286457955}, {'REPORT_ID': '187006', 'DURATION_IN_SEC': 73.0, 'POINT_1_LNG': 10.143257948409996, 'POINT_1_LAT': 56.1601908856982, 'POINT_2_LNG': 10.139025504299298, 'POINT_2_LAT': 56.153267352820414}, {'REPORT_ID': '180547', 'DURATION_IN_SEC': 75.0, 'POINT_1_LNG': 10.151387677246134, 'POINT_1_LAT': 56.16798814878688, 'POINT_2_LNG': 10.143257948409996, 'POINT_2_LAT': 56.1601908856982}, {'REPORT_ID': '185422', 'DURATION_IN_SEC': 57.0, 'POINT_1_LNG': 10.153436152114864, 'POINT_1_LAT': 56.17262995803033, 'POINT_2_LNG': 10.151387677246134, 'POINT_2_LAT': 56.16798814878688}, {'REPORT_ID': '185316', 'DURATION_IN_SEC': 54.0, 'POINT_1_LNG': 10.153436152114864, 'POINT_1_LAT': 56.17262995803033, 'POINT_2_LNG': 10.161823402446771, 'POINT_2_LAT': 56.17304495205962}, {'REPORT_ID': '179390', 'DURATION_IN_SEC': 41.0, 'POINT_1_LNG': 10.161823402446771, 'POINT_1_LAT': 56.17304495205962, 'POINT_2_LNG': 10.171611868717264, 'POINT_2_LAT': 56.174917180024806}, {'REPORT_ID': '179336', 'DURATION_IN_SEC': 65.0, 'POINT_1_LNG': 10.171611868717264, 'POINT_1_LAT': 56.174917180024806, 'POINT_2_LNG': 10.18461071717934, 'POINT_2_LAT': 56.178623267668705}, {'REPORT_ID': '179282', 'DURATION_IN_SEC': 34.0, 'POINT_1_LNG': 10.18461071717934, 'POINT_1_LAT': 56.178623267668705, 'POINT_2_LNG': 10.192906008598356, 'POINT_2_LAT': 56.181353258286634}, {'REPORT_ID': '185078', 'DURATION_IN_SEC': 61.0, 'POINT_1_LNG': 10.192906008598356, 'POINT_1_LAT': 56.181353258286634, 'POINT_2_LNG': 10.19604842460626, 'POINT_2_LAT': 56.184659561973874}, {'REPORT_ID': '192653', 'DURATION_IN_SEC': 55.0, 'POINT_1_LNG': 10.19604842460626, 'POINT_1_LAT': 56.184659561973874, 'POINT_2_LNG': 10.191119927578029, 'POINT_2_LAT': 56.18958131478287}, {'REPORT_ID': '192600', 'DURATION_IN_SEC': 80.0, 'POINT_1_LNG': 10.191119927578029, 'POINT_1_LAT': 56.18958131478287, 'POINT_2_LNG': 10.182444749668093, 'POINT_2_LAT': 56.19922307868954}, {'REPORT_ID': '159043', 'DURATION_IN_SEC': 37.0, 'POINT_1_LNG': 10.182444749668093, 'POINT_1_LAT': 56.19922307868954, 'POINT_2_LNG': 10.175406949737521, 'POINT_2_LAT': 56.20417258212644}, {'REPORT_ID': '158954', 'DURATION_IN_SEC': 46.0, 'POINT_1_LNG': 10.175406949737521, 'POINT_1_LAT': 56.20417258212644, 'POINT_2_LNG': 10.161186577298167, 'POINT_2_LAT': 56.20869704245814}, {'REPORT_ID': '158924', 'DURATION_IN_SEC': 79.0, 'POINT_1_LNG': 10.161186577298167, 'POINT_1_LAT': 56.20869704245814, 'POINT_2_LNG': 10.13978019262504, 'POINT_2_LAT': 56.21508593264829}, {'REPORT_ID': '158505', 'DURATION_IN_SEC': 106.0, 'POINT_1_LNG': 10.13978019262504, 'POINT_1_LAT': 56.21508593264829, 'POINT_2_LNG': 10.116589665412903, 'POINT_2_LAT': 56.22579478256016}, {'REPORT_ID': 'WALKING', 'DURATION_IN_SEC': 48.23956400149524, 'POINT_1_LNG': 10.116589665412903, 'POINT_1_LAT': 56.22579478256016, 'POINT_2_LNG': 10.116847, 'POINT_2_LAT': 56.224939}], 'total_duration': 9612.002554709648}]
    start_longitude, start_latitude = 10.21284, 56.16184  # 北京天安门
    end_longitude, end_latitude = 10.164431,56.130402 # 北京某地示例
    best_3_routes = plan_routes_function(start_longitude, start_latitude, end_longitude, end_latitude, k=3)

    print(best_3_routes)
    return jsonify(best_3_routes)

if __name__ == '__main__':
    # debug 模式方便开发调试，发布生产环境时可去掉 or 改为非debug
    app.run(host='0.0.0.0', port=5000, debug=True)
